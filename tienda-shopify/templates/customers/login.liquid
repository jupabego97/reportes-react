{% comment %}
  Customer Login Page - NANO Tech Store 2026
{% endcomment %}

<section class="auth-section">
  <div class="auth-container">
    <div class="auth-card">
      <!-- Header -->
      <header class="auth-header">
        <div class="auth-logo">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
            <circle cx="12" cy="7" r="4"/>
          </svg>
        </div>
        <h1 class="auth-title">Iniciar Sesión</h1>
        <p class="auth-subtitle">Bienvenido de nuevo a NANO</p>
      </header>

      <!-- Login Form -->
      {%- form 'customer_login', class: 'auth-form' -%}
        {%- if form.errors -%}
          <div class="auth-error">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <line x1="15" y1="9" x2="9" y2="15"/>
              <line x1="9" y1="9" x2="15" y2="15"/>
            </svg>
            <span>{{ form.errors | default_errors }}</span>
          </div>
        {%- endif -%}

        <div class="form-group">
          <label for="CustomerEmail" class="form-label">Correo electrónico</label>
          <div class="input-wrapper">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
              <polyline points="22,6 12,13 2,6"/>
            </svg>
            <input
              type="email"
              name="customer[email]"
              id="CustomerEmail"
              class="form-input"
              autocomplete="email"
              autocapitalize="off"
              autocorrect="off"
              placeholder="tu@email.com"
              required
            >
          </div>
        </div>

        <div class="form-group">
          <label for="CustomerPassword" class="form-label">Contraseña</label>
          <div class="input-wrapper">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
              <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
            </svg>
            <input
              type="password"
              name="customer[password]"
              id="CustomerPassword"
              class="form-input"
              autocomplete="current-password"
              placeholder="••••••••"
              required
            >
            <button type="button" class="password-toggle" aria-label="Mostrar contraseña">
              <svg class="eye-open" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                <circle cx="12" cy="12" r="3"/>
              </svg>
              <svg class="eye-closed" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:none;">
                <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
                <line x1="1" y1="1" x2="23" y2="23"/>
              </svg>
            </button>
          </div>
        </div>

        <div class="form-actions-row">
          <a href="#recover" class="forgot-password">¿Olvidaste tu contraseña?</a>
        </div>

        <button type="submit" class="btn btn--primary btn--full auth-submit">
          <span>Iniciar Sesión</span>
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M5 12h14M12 5l7 7-7 7"/>
          </svg>
        </button>
      {%- endform -%}

      <!-- Divider -->
      <div class="auth-divider">
        <span>¿Eres nuevo?</span>
      </div>

      <!-- Register Link -->
      <a href="{{ routes.account_register_url }}" class="btn btn--secondary btn--full">
        Crear una cuenta
      </a>

      <!-- Back to store -->
      <a href="{{ routes.root_url }}" class="back-to-store">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
        Volver a la tienda
      </a>
    </div>

    <!-- Password Recovery Form (Hidden by default) -->
    <div class="auth-card auth-card--recover" id="recover" style="display: none;">
      <header class="auth-header">
        <div class="auth-logo">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
            <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
          </svg>
        </div>
        <h1 class="auth-title">Recuperar Contraseña</h1>
        <p class="auth-subtitle">Te enviaremos un enlace para restablecer tu contraseña</p>
      </header>

      {%- form 'recover_customer_password', class: 'auth-form' -%}
        {%- if form.posted_successfully? -%}
          <div class="auth-success">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
              <polyline points="22 4 12 14.01 9 11.01"/>
            </svg>
            <span>Te hemos enviado un correo con las instrucciones.</span>
          </div>
        {%- endif -%}

        <div class="form-group">
          <label for="RecoverEmail" class="form-label">Correo electrónico</label>
          <div class="input-wrapper">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
              <polyline points="22,6 12,13 2,6"/>
            </svg>
            <input
              type="email"
              name="email"
              id="RecoverEmail"
              class="form-input"
              autocomplete="email"
              autocapitalize="off"
              autocorrect="off"
              placeholder="tu@email.com"
              required
            >
          </div>
        </div>

        <button type="submit" class="btn btn--primary btn--full auth-submit">
          <span>Enviar enlace</span>
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/>
          </svg>
        </button>

        <a href="#login" class="back-to-login">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
          </svg>
          Volver a iniciar sesión
        </a>
      {%- endform -%}
    </div>
  </div>
</section>

<style>
  .auth-section {
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: var(--space-8) var(--space-4);
    background: linear-gradient(135deg, var(--color-bg) 0%, var(--color-bg-alt) 100%);
  }

  .auth-container {
    width: 100%;
    max-width: 440px;
  }

  .auth-card {
    background: var(--color-surface);
    border-radius: var(--radius-2xl);
    padding: var(--space-10);
    box-shadow: var(--shadow-xl);
    border: 1px solid var(--color-border);
  }

  .auth-header {
    text-align: center;
    margin-bottom: var(--space-8);
  }

  .auth-logo {
    width: 80px;
    height: 80px;
    margin: 0 auto var(--space-4);
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-secondary) 100%);
    border-radius: var(--radius-full);
    color: white;
  }

  .auth-title {
    font-family: var(--font-heading);
    font-size: var(--text-3xl);
    font-weight: 700;
    color: var(--color-text);
    margin: 0 0 var(--space-2);
  }

  .auth-subtitle {
    font-size: var(--text-base);
    color: var(--color-text-secondary);
    margin: 0;
  }

  .auth-form {
    display: flex;
    flex-direction: column;
    gap: var(--space-5);
  }

  .auth-error,
  .auth-success {
    display: flex;
    align-items: center;
    gap: var(--space-3);
    padding: var(--space-4);
    border-radius: var(--radius-lg);
    font-size: var(--text-sm);
    font-weight: 500;
  }

  .auth-error {
    background: var(--color-error-light);
    color: var(--color-error);
    border: 1px solid var(--color-error);
  }

  .auth-success {
    background: var(--color-success-light);
    color: var(--color-success);
    border: 1px solid var(--color-success);
  }

  .form-group {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
  }

  .form-label {
    font-size: var(--text-sm);
    font-weight: 600;
    color: var(--color-text);
  }

  .input-wrapper {
    position: relative;
    display: flex;
    align-items: center;
  }

  .input-wrapper svg:first-child {
    position: absolute;
    left: var(--space-4);
    color: var(--color-text-muted);
    pointer-events: none;
    z-index: 1;
  }

  .form-input {
    width: 100%;
    padding: var(--space-4) var(--space-4) var(--space-4) var(--space-12);
    background: var(--color-bg-alt);
    border: 2px solid transparent;
    border-radius: var(--radius-lg);
    font-size: var(--text-base);
    font-family: var(--font-body);
    color: var(--color-text);
    transition: all var(--transition-fast);
  }

  .form-input:focus {
    outline: none;
    border-color: var(--color-accent);
    background: var(--color-surface);
    box-shadow: 0 0 0 4px var(--color-accent-glow);
  }

  .form-input::placeholder {
    color: var(--color-text-muted);
  }

  .password-toggle {
    position: absolute;
    right: var(--space-4);
    background: none;
    border: none;
    color: var(--color-text-muted);
    cursor: pointer;
    padding: var(--space-1);
    transition: color var(--transition-fast);
  }

  .password-toggle:hover {
    color: var(--color-accent);
  }

  .form-actions-row {
    display: flex;
    justify-content: flex-end;
  }

  .forgot-password {
    font-size: var(--text-sm);
    color: var(--color-accent);
    font-weight: 500;
    transition: color var(--transition-fast);
  }

  .forgot-password:hover {
    color: var(--color-accent-hover);
    text-decoration: underline;
  }

  .auth-submit {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-2);
    padding: var(--space-4) var(--space-6);
    font-size: var(--text-base);
    font-weight: 600;
    margin-top: var(--space-2);
  }

  .auth-divider {
    display: flex;
    align-items: center;
    gap: var(--space-4);
    margin: var(--space-6) 0;
  }

  .auth-divider::before,
  .auth-divider::after {
    content: '';
    flex: 1;
    height: 1px;
    background: var(--color-border);
  }

  .auth-divider span {
    font-size: var(--text-sm);
    color: var(--color-text-muted);
    white-space: nowrap;
  }

  .back-to-store,
  .back-to-login {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-2);
    margin-top: var(--space-6);
    font-size: var(--text-sm);
    color: var(--color-text-secondary);
    transition: color var(--transition-fast);
  }

  .back-to-store:hover,
  .back-to-login:hover {
    color: var(--color-accent);
  }

  /* Responsive */
  @media (max-width: 480px) {
    .auth-card {
      padding: var(--space-6);
    }

    .auth-title {
      font-size: var(--text-2xl);
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Password toggle
    const passwordToggles = document.querySelectorAll('.password-toggle');
    passwordToggles.forEach(toggle => {
      toggle.addEventListener('click', function() {
        const input = this.parentElement.querySelector('input');
        const eyeOpen = this.querySelector('.eye-open');
        const eyeClosed = this.querySelector('.eye-closed');
        
        if (input.type === 'password') {
          input.type = 'text';
          eyeOpen.style.display = 'none';
          eyeClosed.style.display = 'block';
        } else {
          input.type = 'password';
          eyeOpen.style.display = 'block';
          eyeClosed.style.display = 'none';
        }
      });
    });

    // Show/hide recover form
    const recoverLinks = document.querySelectorAll('a[href="#recover"]');
    const loginLinks = document.querySelectorAll('a[href="#login"]');
    const loginCard = document.querySelector('.auth-card:not(.auth-card--recover)');
    const recoverCard = document.querySelector('.auth-card--recover');

    recoverLinks.forEach(link => {
      link.addEventListener('click', function(e) {
        e.preventDefault();
        loginCard.style.display = 'none';
        recoverCard.style.display = 'block';
      });
    });

    loginLinks.forEach(link => {
      link.addEventListener('click', function(e) {
        e.preventDefault();
        recoverCard.style.display = 'none';
        loginCard.style.display = 'block';
      });
    });

    // Check URL hash
    if (window.location.hash === '#recover') {
      loginCard.style.display = 'none';
      recoverCard.style.display = 'block';
    }
  });
</script>
