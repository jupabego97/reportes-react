<!DOCTYPE html>
<html class="no-js" lang="{{ request.locale.iso_code }}" data-theme="light">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, height=device-height, minimum-scale=1.0">
  <meta name="theme-color" content="#6366F1">
  
  <title>
    {{ page_title }}
    {%- if current_tags %} &ndash; tagged "{{ current_tags | join: ', ' }}"{% endif -%}
    {%- if current_page != 1 %} &ndash; Page {{ current_page }}{% endif -%}
    {%- unless page_title contains shop.name %} &ndash; {{ shop.name }}{% endunless -%}
  </title>

  {% if page_description %}
    <meta name="description" content="{{ page_description | escape }}">
  {% endif %}

  <!-- Preconnect para mejorar rendimiento (Low-Carbon) -->
  <link rel="preconnect" href="https://cdn.shopify.com" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="dns-prefetch" href="https://cdn.shopify.com">

  <!-- Preload critical assets -->
  <link rel="preload" href="{{ 'theme.css' | asset_url }}" as="style">
  <link rel="preload" href="{{ 'theme.js' | asset_url }}" as="script">

  <!-- Favicon -->
  {%- if settings.favicon != blank -%}
    <link rel="icon" type="image/png" href="{{ settings.favicon | image_url: width: 32, height: 32 }}">
    <link rel="apple-touch-icon" href="{{ settings.favicon | image_url: width: 180, height: 180 }}">
  {%- endif -%}

  <!-- Canonical URL -->
  <link rel="canonical" href="{{ canonical_url }}">

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="{% if template.name == 'product' %}product{% else %}website{% endif %}">
  <meta property="og:url" content="{{ canonical_url }}">
  <meta property="og:title" content="{{ page_title | escape }}">
  <meta property="og:description" content="{{ page_description | default: shop.description | escape }}">
  {%- if page_image -%}
    <meta property="og:image" content="https:{{ page_image | image_url: width: 1200 }}">
  {%- endif -%}
  <meta property="og:site_name" content="{{ shop.name | escape }}">

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="{{ page_title | escape }}">
  <meta name="twitter:description" content="{{ page_description | default: shop.description | escape }}">
  {%- if page_image -%}
    <meta name="twitter:image" content="https:{{ page_image | image_url: width: 1200 }}">
  {%- endif -%}

  <!-- CSS del tema -->
  {{ 'theme.css' | asset_url | stylesheet_tag }}

  <!-- Etiqueta obligatoria de Shopify - Scripts del head -->
  {{ content_for_header }}

  <!-- JavaScript del tema (defer para no bloquear renderizado) -->
  <script src="{{ 'theme.js' | asset_url }}" defer></script>

  <!-- JSON-LD Structured Data - Organization -->
  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": {{ shop.name | json }},
      "url": {{ shop.url | json }},
      {%- if settings.logo -%}
      "logo": {{ settings.logo | image_url: width: 500 | prepend: 'https:' | json }},
      {%- endif -%}
      "contactPoint": {
        "@type": "ContactPoint",
        "telephone": "+57-300-123-4567",
        "contactType": "customer service",
        "availableLanguage": ["Spanish"]
      },
      "sameAs": [
        {%- if settings.social_facebook_link != blank -%}{{ settings.social_facebook_link | json }},{%- endif -%}
        {%- if settings.social_instagram_link != blank -%}{{ settings.social_instagram_link | json }},{%- endif -%}
        {%- if settings.social_twitter_link != blank -%}{{ settings.social_twitter_link | json }},{%- endif -%}
        {%- if settings.social_youtube_link != blank -%}{{ settings.social_youtube_link | json }}{%- endif -%}
      ]
    }
  </script>

  <!-- JSON-LD - WebSite with SearchAction -->
  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": {{ shop.name | json }},
      "url": {{ shop.url | json }},
      "potentialAction": {
        "@type": "SearchAction",
        "target": {
          "@type": "EntryPoint",
          "urlTemplate": "{{ shop.url }}/search?q={search_term_string}"
        },
        "query-input": "required name=search_term_string"
      }
    }
  </script>

  <!-- JSON-LD - BreadcrumbList -->
  {%- if template.name != 'index' -%}
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
          {
            "@type": "ListItem",
            "position": 1,
            "name": "Inicio",
            "item": {{ shop.url | json }}
          }
          {%- if template.name == 'collection' -%}
          ,{
            "@type": "ListItem",
            "position": 2,
            "name": {{ collection.title | json }},
            "item": {{ collection.url | prepend: shop.url | json }}
          }
          {%- elsif template.name == 'product' -%}
          {%- if product.collections.first -%}
          ,{
            "@type": "ListItem",
            "position": 2,
            "name": {{ product.collections.first.title | json }},
            "item": {{ product.collections.first.url | prepend: shop.url | json }}
          }
          ,{
            "@type": "ListItem",
            "position": 3,
            "name": {{ product.title | json }},
            "item": {{ product.url | prepend: shop.url | json }}
          }
          {%- else -%}
          ,{
            "@type": "ListItem",
            "position": 2,
            "name": {{ product.title | json }},
            "item": {{ product.url | prepend: shop.url | json }}
          }
          {%- endif -%}
          {%- endif -%}
        ]
      }
    </script>
  {%- endif -%}

  <!-- JSON-LD - Product (for product pages) -->
  {%- if template.name == 'product' -%}
    {%- assign current_variant = product.selected_or_first_available_variant -%}
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "Product",
        "name": {{ product.title | json }},
        "description": {{ product.description | strip_html | truncate: 500 | json }},
        "url": {{ product.url | prepend: shop.url | json }},
        {%- if product.featured_image -%}
        "image": [
          {{ product.featured_image | image_url: width: 1200 | prepend: 'https:' | json }}
          {%- for image in product.images offset: 1 limit: 4 -%}
          ,{{ image | image_url: width: 1200 | prepend: 'https:' | json }}
          {%- endfor -%}
        ],
        {%- endif -%}
        "sku": {{ current_variant.sku | json }},
        {%- if product.vendor != blank -%}
        "brand": {
          "@type": "Brand",
          "name": {{ product.vendor | json }}
        },
        {%- endif -%}
        "offers": {
          "@type": "Offer",
          "url": {{ product.url | prepend: shop.url | json }},
          "priceCurrency": {{ cart.currency.iso_code | json }},
          "price": {{ current_variant.price | money_without_currency | remove: ',' | json }},
          "availability": "{% if current_variant.available %}https://schema.org/InStock{% else %}https://schema.org/OutOfStock{% endif %}",
          "seller": {
            "@type": "Organization",
            "name": {{ shop.name | json }}
          }
          {%- if current_variant.compare_at_price > current_variant.price -%}
          ,"priceValidUntil": "{{ 'now' | date: '%Y' | plus: 1 }}-12-31"
          {%- endif -%}
        }
        {%- if product.metafields.reviews.rating.value != blank -%}
        ,"aggregateRating": {
          "@type": "AggregateRating",
          "ratingValue": {{ product.metafields.reviews.rating.value.rating | json }},
          "reviewCount": {{ product.metafields.reviews.rating_count | json }}
        }
        {%- endif -%}
      }
    </script>
  {%- endif -%}

  <!-- JSON-LD - Collection (for collection pages) -->
  {%- if template.name == 'collection' -%}
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "CollectionPage",
        "name": {{ collection.title | json }},
        "description": {{ collection.description | strip_html | json }},
        "url": {{ collection.url | prepend: shop.url | json }},
        "numberOfItems": {{ collection.products_count }}
      }
    </script>
  {%- endif -%}

  <!-- Theme variables from settings - Paleta NANO -->
  <style>
    :root {
      --color-primary: {{ settings.color_primary | default: '#14B8A6' }};
      --color-secondary: {{ settings.color_secondary | default: '#38BDF8' }};
      --color-background: {{ settings.color_background | default: '#F0F9FF' }};
      --color-text: {{ settings.color_text | default: '#0F172A' }};
      --color-brand-teal: #2DD4BF;
      --color-brand-blue: #7DD3FC;
      {%- if settings.font_heading -%}
      --font-heading: {{ settings.font_heading.family }}, {{ settings.font_heading.fallback_families }};
      {%- endif -%}
      {%- if settings.font_body -%}
      --font-body: {{ settings.font_body.family }}, {{ settings.font_body.fallback_families }};
      {%- endif -%}
    }
  </style>

  <!-- Inline critical CSS for faster first paint -->
  <style>
    /* Critical CSS for above-the-fold content */
    body { 
      opacity: 1;
    }
  </style>
</head>

<body class="template-{{ template.name | handle }}{% if template.suffix %} template-{{ template.name }}-{{ template.suffix | handle }}{% endif %}">
  
  <!-- Skip to content (Accessibility) -->
  <a class="skip-to-content-link visually-hidden" href="#MainContent">
    {{ 'accessibility.skip_to_content' | t | default: 'Saltar al contenido' }}
  </a>

  <!-- Header Section -->
  {% section 'header' %}

  <!-- Main Content -->
  <main id="MainContent" class="main-content" role="main" tabindex="-1">
    {{ content_for_layout }}
  </main>

  <!-- Footer Section -->
  {% section 'footer' %}

  <!-- Accessibility: Announce route changes for screen readers -->
  <div id="route-announcer" class="visually-hidden" role="status" aria-live="polite" aria-atomic="true"></div>

  <!-- Noscript fallback -->
  <noscript>
    <style>
      .reveal, .reveal-stagger > * {
        opacity: 1 !important;
        transform: none !important;
      }
      body { opacity: 1 !important; }
    </style>
  </noscript>
</body>
</html>
