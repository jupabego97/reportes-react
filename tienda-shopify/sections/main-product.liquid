{% comment %}
  Product Page - Patr贸n Z Layout 2026
  Optimizado para conversi贸n con elementos hand-drawn
{% endcomment %}

{%- assign current_variant = product.selected_or_first_available_variant -%}
{%- unless current_variant -%}
  {%- assign current_variant = product.variants.first -%}
{%- endunless -%}

<section class="product-page" data-section-id="{{ section.id }}" itemscope itemtype="https://schema.org/Product">
  <div class="product-page__container">
    
    <!-- Breadcrumb -->
    <nav class="product-breadcrumb reveal" aria-label="Breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
      <ol class="product-breadcrumb__list">
        <li class="product-breadcrumb__item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="{{ routes.root_url }}" itemprop="item"><span itemprop="name">Inicio</span></a>
          <meta itemprop="position" content="1">
        </li>
        {%- if product.collections.first -%}
          <li class="product-breadcrumb__item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <a href="{{ product.collections.first.url }}" itemprop="item"><span itemprop="name">{{ product.collections.first.title }}</span></a>
            <meta itemprop="position" content="2">
          </li>
        {%- endif -%}
        <li class="product-breadcrumb__item product-breadcrumb__item--current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <span itemprop="name">{{ product.title }}</span>
          <meta itemprop="position" content="3">
        </li>
      </ol>
    </nav>

    <div class="product-layout reveal-stagger">
      
      <!-- Patr贸n Z: Esquina Superior Izquierda - Galer铆a -->
      <div class="product-gallery">
        <div class="product-gallery__main">
          {%- if product.featured_media -%}
            <div class="product-gallery__image" data-product-media>
              {{ product.featured_media | image_url: width: 900 | image_tag: 
                loading: 'eager',
                class: 'product-gallery__img',
                widths: '400, 600, 800, 1000',
                sizes: '(min-width: 1024px) 50vw, 100vw',
                itemprop: 'image'
              }}
              
              {%- if product.compare_at_price > product.price -%}
                <span class="product-gallery__badge badge badge--sale badge--stopping">
                  -{{ product.compare_at_price | minus: product.price | times: 100 | divided_by: product.compare_at_price }}%
                </span>
              {%- endif -%}

              <!-- Zoom button -->
              <button class="product-gallery__zoom" aria-label="Ampliar imagen">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="11" cy="11" r="8"/>
                  <path d="M21 21l-4.35-4.35M11 8v6M8 11h6"/>
                </svg>
              </button>
            </div>
          {%- else -%}
            <div class="product-gallery__image product-gallery__image--empty">
              <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                <circle cx="8.5" cy="8.5" r="1.5"/>
                <polyline points="21 15 16 10 5 21"/>
              </svg>
            </div>
          {%- endif -%}
        </div>

        <!-- Thumbnails -->
        {%- if product.media.size > 1 -%}
          <div class="product-gallery__thumbs">
            {%- for media in product.media limit: 5 -%}
              <button 
                class="product-gallery__thumb{% if forloop.first %} product-gallery__thumb--active{% endif %}"
                data-media-id="{{ media.id }}"
                aria-label="Ver imagen {{ forloop.index }}"
              >
                {{ media | image_url: width: 100 | image_tag: loading: 'lazy', class: 'product-gallery__thumb-img' }}
              </button>
            {%- endfor -%}
          </div>
        {%- endif -%}
      </div>

      <!-- Patr贸n Z: Esquina Superior Derecha - Info Principal -->
      <div class="product-info">
        
        <!-- Vendor -->
        {%- if product.vendor != blank -%}
          <span class="product-info__vendor" itemprop="brand" itemscope itemtype="https://schema.org/Brand">
            <span itemprop="name">{{ product.vendor }}</span>
          </span>
        {%- endif -%}

        <!-- Title -->
        <h1 class="product-info__title" itemprop="name">{{ product.title }}</h1>

        <!-- Rating (placeholder) -->
        <div class="product-info__rating" itemprop="aggregateRating" itemscope itemtype="https://schema.org/AggregateRating">
          <div class="product-info__stars">
            {%- for i in (1..5) -%}
              <svg width="18" height="18" viewBox="0 0 24 24" fill="{% if i <= 4 %}currentColor{% else %}none{% endif %}" stroke="currentColor" stroke-width="2">
                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
              </svg>
            {%- endfor -%}
          </div>
          <span class="product-info__rating-text">
            <span itemprop="ratingValue">4.5</span>/5 
            (<span itemprop="reviewCount">24</span> rese帽as)
          </span>
        </div>

        <!-- Price -->
        <div class="product-info__price" itemprop="offers" itemscope itemtype="https://schema.org/Offer">
          <link itemprop="url" href="{{ shop.url }}{{ product.url }}">
          <meta itemprop="priceCurrency" content="{{ cart.currency.iso_code }}">
          <meta itemprop="price" content="{{ current_variant.price | money_without_currency | remove: ',' }}">
          
          {%- if product.compare_at_price > product.price -%}
            <span class="product-info__price-compare">{{ product.compare_at_price | money }}</span>
            <span class="product-info__price-current product-info__price-current--sale">{{ product.price | money }}</span>
            <span class="product-info__price-save text-handwritten">
              隆Ahorras {{ product.compare_at_price | minus: product.price | money }}!
            </span>
          {%- else -%}
            <span class="product-info__price-current">{{ product.price | money }}</span>
          {%- endif -%}

          <!-- Availability -->
          {%- if current_variant.available -%}
            <meta itemprop="availability" content="https://schema.org/InStock">
            <span class="product-info__stock product-info__stock--in">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                <polyline points="22 4 12 14.01 9 11.01"/>
              </svg>
              En stock - Listo para enviar
            </span>
          {%- else -%}
            <meta itemprop="availability" content="https://schema.org/OutOfStock">
            <span class="product-info__stock product-info__stock--out">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <line x1="15" y1="9" x2="9" y2="15"/>
                <line x1="9" y1="9" x2="15" y2="15"/>
              </svg>
              Agotado temporalmente
            </span>
          {%- endif -%}
        </div>

        <!-- Urgency Message (Hand-drawn style) -->
        {%- if current_variant.available and section.settings.show_urgency -%}
          <div class="product-info__urgency">
            <span class="product-info__urgency-icon"></span>
            <span class="product-info__urgency-text">
              <span class="handdrawn-underline">隆ltimas unidades!</span> 
              <span class="text-handwritten">Alta demanda</span>
            </span>
          </div>
        {%- endif -%}

        <!-- Product Form -->
        {%- form 'product', product, class: 'product-form', id: 'product-form-{{ section.id }}', data-product-form: '' -%}
          <input type="hidden" name="id" data-product-variant-id value="{{ current_variant.id }}">

          <!-- Variants -->
          {%- unless product.has_only_default_variant -%}
            <div class="product-form__variants">
              {%- for option in product.options_with_values -%}
                <div class="product-form__option">
                  <label class="product-form__label">
                    {{ option.name }}: <span class="product-form__label-value">{{ option.selected_value }}</span>
                  </label>
                  <div class="product-form__options">
                    {%- for value in option.values -%}
                      <label class="product-form__option-item">
                        <input 
                          type="radio" 
                          name="options[{{ option.name }}]" 
                          value="{{ value }}"
                          {% if option.selected_value == value %}checked{% endif %}
                          data-variant-option
                          class="visually-hidden"
                        >
                        <span class="product-form__option-label">{{ value }}</span>
                      </label>
                    {%- endfor -%}
                  </div>
                </div>
              {%- endfor -%}
            </div>
          {%- endunless -%}

          <!-- Quantity -->
          <div class="product-form__quantity">
            <label class="product-form__label">Cantidad</label>
            <div class="quantity-selector">
              <button type="button" class="quantity-btn" data-action="minus" aria-label="Reducir cantidad">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="5" y1="12" x2="19" y2="12"/>
                </svg>
              </button>
              <input type="number" name="quantity" value="1" min="1" class="quantity-input" aria-label="Cantidad">
              <button type="button" class="quantity-btn" data-action="plus" aria-label="Aumentar cantidad">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="12" y1="5" x2="12" y2="19"/>
                  <line x1="5" y1="12" x2="19" y2="12"/>
                </svg>
              </button>
            </div>
          </div>

          <!-- Patr贸n Z: Esquina Inferior Derecha - CTA Principal -->
          <div class="product-form__actions">
            <button 
              type="submit" 
              name="add" 
              class="btn btn--primary btn--lg btn--full product-form__submit"
              {% unless current_variant.available %}disabled{% endunless %}
            >
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="9" cy="21" r="1"/>
                <circle cx="20" cy="21" r="1"/>
                <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
              </svg>
              <span class="product-form__submit-text">
                {%- if current_variant.available -%}
                  Agregar al carrito
                {%- else -%}
                  Agotado
                {%- endif -%}
              </span>
            </button>

            <button type="button" class="btn btn--secondary product-form__wishlist" aria-label="Agregar a favoritos">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
              </svg>
            </button>
          </div>

          <!-- Buy Now -->
          {%- if section.settings.show_buy_now and current_variant.available -%}
            <button type="submit" name="checkout" class="btn btn--ghost btn--full product-form__buy-now">
              Comprar ahora
            </button>
          {%- endif -%}
        {%- endform -%}

        <!-- Trust Badges -->
        <div class="product-info__trust">
          <div class="product-info__trust-item">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="1" y="3" width="15" height="13"/>
              <polygon points="16 8 20 8 23 11 23 16 16 16 16 8"/>
              <circle cx="5.5" cy="18.5" r="2.5"/>
              <circle cx="18.5" cy="18.5" r="2.5"/>
            </svg>
            <span>Env铆o gratis +$100k</span>
          </div>
          <div class="product-info__trust-item">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
            </svg>
            <span>Garant铆a 6 meses</span>
          </div>
          <div class="product-info__trust-item">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="23 4 23 10 17 10"/>
              <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
            </svg>
            <span>30 d铆as devoluci贸n</span>
          </div>
        </div>
      </div>

      <!-- Patr贸n Z: Parte Inferior - Descripci贸n -->
      <div class="product-details">
        {%- if product.description != blank -%}
          <details class="product-details__section" open>
            <summary class="product-details__toggle">
              <span>Descripci贸n del producto</span>
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="6 9 12 15 18 9"/>
              </svg>
            </summary>
            <div class="product-details__content rte" itemprop="description">
              {{ product.description }}
            </div>
          </details>
        {%- endif -%}

        <details class="product-details__section">
          <summary class="product-details__toggle">
            <span>Informaci贸n de env铆o</span>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="6 9 12 15 18 9"/>
            </svg>
          </summary>
          <div class="product-details__content">
            <p>Env铆o gratis en pedidos mayores a $100.000. Tiempo de entrega estimado: 2-5 d铆as h谩biles seg煤n tu ubicaci贸n.</p>
          </div>
        </details>

        <details class="product-details__section">
          <summary class="product-details__toggle">
            <span>Pol铆tica de devoluciones</span>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="6 9 12 15 18 9"/>
            </svg>
          </summary>
          <div class="product-details__content">
            <p>Tienes 30 d铆as para devolver tu producto si no est谩s satisfecho. El producto debe estar en su empaque original.</p>
          </div>
        </details>

        <!-- Share -->
        <div class="product-share">
          <span class="product-share__label">Compartir:</span>
          <div class="product-share__buttons">
            <a href="https://www.facebook.com/sharer/sharer.php?u={{ shop.url }}{{ product.url }}" target="_blank" rel="noopener" class="product-share__btn" aria-label="Compartir en Facebook">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                <path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"/>
              </svg>
            </a>
            <a href="https://twitter.com/intent/tweet?url={{ shop.url }}{{ product.url }}&text={{ product.title | url_encode }}" target="_blank" rel="noopener" class="product-share__btn" aria-label="Compartir en Twitter">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                <path d="M23 3a10.9 10.9 0 01-3.14 1.53 4.48 4.48 0 00-7.86 3v1A10.66 10.66 0 013 4s-4 9 5 13a11.64 11.64 0 01-7 2c9 5 20 0 20-11.5a4.5 4.5 0 00-.08-.83A7.72 7.72 0 0023 3z"/>
              </svg>
            </a>
            <a href="https://wa.me/?text={{ product.title | url_encode }}%20{{ shop.url }}{{ product.url }}" target="_blank" rel="noopener" class="product-share__btn" aria-label="Compartir en WhatsApp">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
              </svg>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  .product-page {
    padding: var(--space-8) 0 var(--space-16);
    background: var(--color-bg);
  }

  .product-page__container {
    max-width: var(--container-max);
    margin: 0 auto;
    padding: 0 var(--container-padding);
  }

  /* Breadcrumb */
  .product-breadcrumb {
    margin-bottom: var(--space-8);
  }

  .product-breadcrumb__list {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    list-style: none;
    font-size: var(--text-sm);
    color: var(--color-text-secondary);
  }

  .product-breadcrumb__item {
    display: flex;
    align-items: center;
    gap: var(--space-2);
  }

  .product-breadcrumb__item::after {
    content: '/';
    color: var(--color-text-muted);
  }

  .product-breadcrumb__item:last-child::after {
    display: none;
  }

  .product-breadcrumb__item a:hover {
    color: var(--color-accent);
  }

  .product-breadcrumb__item--current {
    color: var(--color-text);
    font-weight: 500;
  }

  /* Layout - Patr贸n Z */
  .product-layout {
    display: grid;
    grid-template-columns: 1fr 1fr;
    grid-template-rows: auto auto;
    gap: var(--space-10);
  }

  /* Gallery */
  .product-gallery {
    position: sticky;
    top: 100px;
    align-self: start;
  }

  .product-gallery__main {
    position: relative;
    border-radius: var(--radius-2xl);
    overflow: hidden;
    background: var(--color-surface);
    border: 1px solid var(--color-border);
  }

  .product-gallery__image {
    aspect-ratio: 1;
  }

  .product-gallery__img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .product-gallery__image--empty {
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--color-text-muted);
  }

  .product-gallery__badge {
    position: absolute;
    top: var(--space-4);
    left: var(--space-4);
  }

  .product-gallery__zoom {
    position: absolute;
    bottom: var(--space-4);
    right: var(--space-4);
    width: 44px;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-full);
    color: var(--color-text);
    transition: all var(--transition-fast);
  }

  .product-gallery__zoom:hover {
    background: var(--color-accent);
    color: white;
    border-color: var(--color-accent);
  }

  .product-gallery__thumbs {
    display: flex;
    gap: var(--space-3);
    margin-top: var(--space-4);
    overflow-x: auto;
    padding-bottom: var(--space-2);
  }

  .product-gallery__thumb {
    flex-shrink: 0;
    width: 72px;
    height: 72px;
    border-radius: var(--radius-lg);
    overflow: hidden;
    border: 2px solid var(--color-border);
    background: var(--color-surface);
    transition: all var(--transition-fast);
    cursor: pointer;
  }

  .product-gallery__thumb:hover,
  .product-gallery__thumb--active {
    border-color: var(--color-accent);
  }

  .product-gallery__thumb-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  /* Product Info */
  .product-info {
    display: flex;
    flex-direction: column;
    gap: var(--space-4);
  }

  .product-info__vendor {
    font-size: var(--text-sm);
    font-weight: 600;
    color: var(--color-accent);
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .product-info__title {
    font-family: var(--font-heading);
    font-size: var(--text-3xl);
    font-weight: 700;
    color: var(--color-text);
    line-height: 1.2;
  }

  .product-info__rating {
    display: flex;
    align-items: center;
    gap: var(--space-3);
  }

  .product-info__stars {
    display: flex;
    color: #FBBF24;
  }

  .product-info__rating-text {
    font-size: var(--text-sm);
    color: var(--color-text-secondary);
  }

  /* Price */
  .product-info__price {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: var(--space-3);
    padding: var(--space-4) 0;
    border-top: 1px solid var(--color-border);
    border-bottom: 1px solid var(--color-border);
  }

  .product-info__price-current {
    font-family: var(--font-heading);
    font-size: var(--text-3xl);
    font-weight: 700;
    color: var(--color-text);
  }

  .product-info__price-current--sale {
    color: var(--color-error);
  }

  .product-info__price-compare {
    font-size: var(--text-xl);
    color: var(--color-text-muted);
    text-decoration: line-through;
  }

  .product-info__price-save {
    font-size: var(--text-lg);
    padding: var(--space-1) var(--space-3);
    background: var(--color-success-light);
    color: var(--color-success);
    border-radius: var(--radius-full);
  }

  .product-info__stock {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    font-size: var(--text-sm);
    font-weight: 500;
    width: 100%;
    margin-top: var(--space-2);
  }

  .product-info__stock--in {
    color: var(--color-success);
  }

  .product-info__stock--out {
    color: var(--color-error);
  }

  /* Urgency */
  .product-info__urgency {
    display: flex;
    align-items: center;
    gap: var(--space-3);
    padding: var(--space-3) var(--space-4);
    background: var(--color-warning-light);
    border-radius: var(--radius-lg);
    font-size: var(--text-sm);
    font-weight: 500;
  }

  .product-info__urgency-icon {
    font-size: var(--text-lg);
  }

  /* Product Form */
  .product-form__variants {
    display: flex;
    flex-direction: column;
    gap: var(--space-5);
    margin-bottom: var(--space-5);
  }

  .product-form__label {
    display: block;
    font-size: var(--text-sm);
    font-weight: 600;
    color: var(--color-text);
    margin-bottom: var(--space-3);
  }

  .product-form__label-value {
    color: var(--color-accent);
  }

  .product-form__options {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2);
  }

  .product-form__option-label {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 48px;
    padding: var(--space-2) var(--space-4);
    font-size: var(--text-sm);
    font-weight: 500;
    background: var(--color-bg-alt);
    border: 2px solid var(--color-border);
    border-radius: var(--radius-lg);
    cursor: pointer;
    transition: all var(--transition-fast);
  }

  .product-form__option-item input:checked + .product-form__option-label {
    border-color: var(--color-accent);
    background: var(--color-accent-light);
    color: var(--color-accent);
  }

  .product-form__option-label:hover {
    border-color: var(--color-text-muted);
  }

  .product-form__quantity {
    margin-bottom: var(--space-5);
  }

  .product-form__actions {
    display: flex;
    gap: var(--space-3);
    margin-bottom: var(--space-3);
  }

  .product-form__submit {
    flex: 1;
  }

  .product-form__wishlist {
    width: 56px;
    height: 56px;
    padding: 0;
    flex-shrink: 0;
  }

  .product-form__buy-now {
    margin-bottom: var(--space-5);
  }

  /* Trust */
  .product-info__trust {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--space-3);
    padding: var(--space-4);
    background: var(--color-bg-alt);
    border-radius: var(--radius-xl);
  }

  .product-info__trust-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    gap: var(--space-2);
    font-size: var(--text-xs);
    font-weight: 500;
    color: var(--color-text-secondary);
  }

  .product-info__trust-item svg {
    color: var(--color-accent);
  }

  /* Product Details */
  .product-details {
    grid-column: span 2;
    display: flex;
    flex-direction: column;
    gap: var(--space-4);
    padding-top: var(--space-8);
    border-top: 1px solid var(--color-border);
  }

  .product-details__section {
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-xl);
    overflow: hidden;
  }

  .product-details__toggle {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    padding: var(--space-4) var(--space-5);
    font-size: var(--text-base);
    font-weight: 600;
    color: var(--color-text);
    cursor: pointer;
    list-style: none;
  }

  .product-details__toggle::-webkit-details-marker {
    display: none;
  }

  .product-details__toggle svg {
    transition: transform var(--transition-fast);
    color: var(--color-text-muted);
  }

  .product-details__section[open] .product-details__toggle svg {
    transform: rotate(180deg);
  }

  .product-details__content {
    padding: 0 var(--space-5) var(--space-5);
    font-size: var(--text-base);
    color: var(--color-text-secondary);
    line-height: 1.7;
  }

  .product-details__content.rte h2,
  .product-details__content.rte h3 {
    margin-top: var(--space-4);
    margin-bottom: var(--space-2);
  }

  .product-details__content.rte ul,
  .product-details__content.rte ol {
    padding-left: var(--space-5);
    margin-bottom: var(--space-4);
  }

  /* Share */
  .product-share {
    display: flex;
    align-items: center;
    gap: var(--space-4);
    padding: var(--space-4) 0;
  }

  .product-share__label {
    font-size: var(--text-sm);
    color: var(--color-text-secondary);
  }

  .product-share__buttons {
    display: flex;
    gap: var(--space-2);
  }

  .product-share__btn {
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--color-bg-alt);
    border-radius: var(--radius-full);
    color: var(--color-text-secondary);
    transition: all var(--transition-fast);
  }

  .product-share__btn:hover {
    background: var(--color-accent);
    color: white;
  }

  /* Responsive */
  @media (max-width: 1024px) {
    .product-layout {
      grid-template-columns: 1fr;
      gap: var(--space-8);
    }

    .product-gallery {
      position: static;
    }

    .product-details {
      grid-column: span 1;
    }
  }

  @media (max-width: 768px) {
    .product-page {
      padding: var(--space-4) 0 var(--space-10);
    }

    .product-info__title {
      font-size: var(--text-2xl);
    }

    .product-info__price-current {
      font-size: var(--text-2xl);
    }

    .product-form__actions {
      flex-direction: column;
    }

    .product-form__wishlist {
      width: 100%;
      height: 48px;
    }

    .product-info__trust {
      grid-template-columns: 1fr;
      gap: var(--space-2);
    }

    .product-info__trust-item {
      flex-direction: row;
      text-align: left;
    }
  }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const productData = {{ product | json }};
  const currentVariantId = {{ current_variant.id }};
  const variantIdInput = document.querySelector('[data-product-variant-id]');
  const addToCartBtn = document.querySelector('.product-form__submit');
  const productForm = document.querySelector('[data-product-form]');
  const submitText = document.querySelector('.product-form__submit-text');
  
  // DEBUG: Mostrar informaci贸n del producto
  console.log('=== DEBUG PRODUCTO ===');
  console.log('Producto:', productData.title);
  console.log('ID de variante actual:', currentVariantId);
  console.log('product.available (Liquid):', {{ product.available | json }});
  console.log('current_variant.available (Liquid):', {{ current_variant.available | json }});
  console.log('Todas las variantes:', productData.variants.map(v => ({
    id: v.id,
    title: v.title,
    available: v.available,
    inventory_quantity: v.inventory_quantity,
    inventory_management: v.inventory_management,
    inventory_policy: v.inventory_policy
  })));
  console.log('======================');
  
  // Asegurar que el variant ID inicial es correcto
  if (variantIdInput) {
    variantIdInput.value = currentVariantId;
  }

  // Verificar disponibilidad inicial
  const initialVariant = productData.variants.find(v => v.id === currentVariantId);
  console.log('Variante inicial encontrada:', initialVariant);
  
  if (initialVariant && addToCartBtn) {
    if (initialVariant.available) {
      addToCartBtn.disabled = false;
      if (submitText) submitText.textContent = 'Agregar al carrito';
    } else {
      addToCartBtn.disabled = true;
      if (submitText) submitText.textContent = 'Agotado';
    }
  }
  
  // Quantity selector
  document.querySelectorAll('.product-form .quantity-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      const input = this.parentElement.querySelector('.quantity-input');
      let value = parseInt(input.value) || 1;
      
      if (this.dataset.action === 'minus') {
        value = Math.max(1, value - 1);
      } else {
        value = value + 1;
      }
      
      input.value = value;
    });
  });

  // Thumbnail selector
  const thumbnails = document.querySelectorAll('.product-gallery__thumb');
  const mainImage = document.querySelector('.product-gallery__img');
  
  thumbnails.forEach(thumb => {
    thumb.addEventListener('click', function() {
      thumbnails.forEach(t => t.classList.remove('product-gallery__thumb--active'));
      this.classList.add('product-gallery__thumb--active');
      
      const mediaId = this.dataset.mediaId;
      const media = productData.media.find(m => m.id == mediaId);
      if (media && mainImage) {
        mainImage.src = media.src;
        mainImage.alt = media.alt || productData.title;
      }
    });
  });

  // Variant handling - solo si hay variantes
  const variantOptions = document.querySelectorAll('[data-variant-option]');
  
  if (variantOptions.length > 0) {
    function getSelectedOptions() {
      const options = [];
      document.querySelectorAll('.product-form__option').forEach((selector, index) => {
        const checked = selector.querySelector('input:checked');
        if (checked) {
          options[index] = checked.value;
          const labelValue = selector.querySelector('.product-form__label-value');
          if (labelValue) labelValue.textContent = checked.value;
        }
      });
      return options;
    }

    function findVariant(options) {
      return productData.variants.find(variant => {
        return options.every((option, index) => {
          return variant['option' + (index + 1)] === option;
        });
      });
    }

    function updateVariant() {
      const selectedOptions = getSelectedOptions();
      const variant = findVariant(selectedOptions);
      
      if (variant) {
        variantIdInput.value = variant.id;
        
        if (variant.available) {
          addToCartBtn.disabled = false;
          if (submitText) submitText.textContent = 'Agregar al carrito';
        } else {
          addToCartBtn.disabled = true;
          if (submitText) submitText.textContent = 'Agotado';
        }
        
        // Actualizar precio si cambia
        const priceEl = document.querySelector('.product-info__price-current');
        if (priceEl && variant.price) {
          const formattedPrice = (variant.price / 100).toLocaleString('es-CO', {
            style: 'currency',
            currency: 'COP',
            minimumFractionDigits: 0
          });
          priceEl.textContent = formattedPrice;
        }
        
        const url = new URL(window.location);
        url.searchParams.set('variant', variant.id);
        window.history.replaceState({}, '', url);
      }
    }

    variantOptions.forEach(option => {
      option.addEventListener('change', updateVariant);
    });
  }

  // Form submission with AJAX
  if (productForm) {
    productForm.addEventListener('submit', async function(e) {
      // Si es checkout, dejar que proceda normal
      if (e.submitter && e.submitter.name === 'checkout') return;
      
      e.preventDefault();
      
      const variantId = parseInt(variantIdInput.value);
      const quantityInput = this.querySelector('[name="quantity"]');
      const quantity = quantityInput ? parseInt(quantityInput.value) || 1 : 1;
      const originalText = submitText ? submitText.textContent : 'Agregar al carrito';

      console.log('Adding to cart:', { variantId, quantity });

      if (!variantId) {
        if (window.showNotification) {
          window.showNotification('Error: No se pudo identificar el producto', 'error');
        }
        return;
      }

      addToCartBtn.disabled = true;
      if (submitText) submitText.textContent = 'Agregando...';

      try {
        console.log('=== ENVIANDO A CARRITO ===');
        console.log('Variant ID:', variantId, 'Tipo:', typeof variantId);
        console.log('Quantity:', quantity, 'Tipo:', typeof quantity);
        
        // Verificar que la variante existe y est谩 disponible antes de enviar
        const variantToAdd = productData.variants.find(v => v.id === variantId);
        console.log('Variante a agregar:', variantToAdd);
        
        if (variantToAdd && !variantToAdd.available) {
          console.warn('ADVERTENCIA: La variante NO est谩 marcada como disponible en los datos del producto');
        }
        
        const response = await fetch('/cart/add.js', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
          },
          body: JSON.stringify({
            items: [{
              id: variantId,
              quantity: quantity
            }]
          })
        });

        const result = await response.json();
        console.log('Cart response status:', response.status);
        console.log('Cart response:', result);

        if (response.ok) {
          // Actualizar contador del carrito
          const cartResponse = await fetch('/cart.js');
          const cartData = await cartResponse.json();
          
          document.querySelectorAll('.cart-count, [data-cart-count], .header__cart-count').forEach(counter => {
            counter.textContent = cartData.item_count;
            counter.classList.remove('hidden');
          });

          if (submitText) submitText.textContent = '隆Agregado!';
          addToCartBtn.style.background = 'var(--color-success)';
          
          const itemTitle = result.items ? result.items[0].product_title : (result.product_title || result.title);
          if (window.showNotification) {
            window.showNotification(`"${itemTitle}" agregado al carrito`, 'success');
          }
          
          setTimeout(() => {
            addToCartBtn.disabled = false;
            addToCartBtn.style.background = '';
            if (submitText) submitText.textContent = originalText;
          }, 2000);
        } else {
          console.error('Cart error response:', result);
          throw new Error(result.description || result.message || 'Error al agregar');
        }
      } catch (error) {
        console.error('Error:', error);
        if (window.showNotification) {
          window.showNotification(error.message, 'error');
        }
        addToCartBtn.disabled = false;
        if (submitText) submitText.textContent = originalText;
      }
    });
  }
});
</script>

{% schema %}
{
  "name": "Producto 2026",
  "tag": "section",
  "class": "section-product",
  "settings": [
    {
      "type": "checkbox",
      "id": "show_vendor",
      "label": "Mostrar marca/vendor",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_buy_now",
      "label": "Mostrar bot贸n 'Comprar ahora'",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_urgency",
      "label": "Mostrar mensaje de urgencia",
      "default": true,
      "info": "Muestra '隆ltimas unidades!' para crear urgencia"
    },
    {
      "type": "checkbox",
      "id": "show_share_buttons",
      "label": "Mostrar botones de compartir",
      "default": true
    }
  ]
}
{% endschema %}
