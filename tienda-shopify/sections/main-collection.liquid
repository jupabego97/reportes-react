{%- paginate collection.products by section.settings.products_per_page -%}
<section class="collection-section" data-section-id="{{ section.id }}">
  <div class="collection-container">
    <!-- Header de colección -->
    <div class="collection-header">
      {%- if collection.image -%}
        <div class="collection-banner">
          {{ collection.image | image_url: width: 1600 | image_tag:
            loading: 'eager',
            class: 'collection-banner-image',
            widths: '800, 1200, 1600',
            sizes: '100vw'
          }}
          <div class="collection-banner-overlay"></div>
          <div class="collection-banner-content">
            <h1 class="collection-title">{{ collection.title }}</h1>
            {%- if collection.description != blank -%}
              <div class="collection-description">{{ collection.description }}</div>
            {%- endif -%}
          </div>
        </div>
      {%- else -%}
        <div class="collection-header-simple">
          <h1 class="collection-title">{{ collection.title }}</h1>
          {%- if collection.description != blank -%}
            <div class="collection-description">{{ collection.description }}</div>
          {%- endif -%}
        </div>
      {%- endif -%}
    </div>

    <!-- Toolbar (filtros y ordenamiento) -->
    <div class="collection-toolbar">
      <div class="toolbar-left">
        <button class="filter-toggle" aria-expanded="false" aria-controls="collection-filters">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="4" y1="21" x2="4" y2="14"/>
            <line x1="4" y1="10" x2="4" y2="3"/>
            <line x1="12" y1="21" x2="12" y2="12"/>
            <line x1="12" y1="8" x2="12" y2="3"/>
            <line x1="20" y1="21" x2="20" y2="16"/>
            <line x1="20" y1="12" x2="20" y2="3"/>
            <line x1="1" y1="14" x2="7" y2="14"/>
            <line x1="9" y1="8" x2="15" y2="8"/>
            <line x1="17" y1="16" x2="23" y2="16"/>
          </svg>
          Filtros
        </button>
        <span class="products-count">{{ collection.products_count }} productos</span>
      </div>

      <div class="toolbar-right">
        <!-- Ordenamiento -->
        <div class="sort-wrapper">
          <label for="sort-select" class="visually-hidden">Ordenar por</label>
          <select id="sort-select" class="sort-select" onchange="window.location.href = this.value">
            {%- for option in collection.sort_options -%}
              <option value="{{ option.url }}" {% if option.value == collection.sort_by %}selected{% endif %}>
                {{ option.name }}
              </option>
            {%- endfor -%}
          </select>
          <svg class="sort-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="6 9 12 15 18 9"/>
          </svg>
        </div>

        <!-- Vista grid/list -->
        <div class="view-toggle">
          <button class="view-btn active" data-view="grid" aria-label="Vista en cuadrícula">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="7" height="7"/>
              <rect x="14" y="3" width="7" height="7"/>
              <rect x="14" y="14" width="7" height="7"/>
              <rect x="3" y="14" width="7" height="7"/>
            </svg>
          </button>
          <button class="view-btn" data-view="list" aria-label="Vista en lista">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="8" y1="6" x2="21" y2="6"/>
              <line x1="8" y1="12" x2="21" y2="12"/>
              <line x1="8" y1="18" x2="21" y2="18"/>
              <line x1="3" y1="6" x2="3.01" y2="6"/>
              <line x1="3" y1="12" x2="3.01" y2="12"/>
              <line x1="3" y1="18" x2="3.01" y2="18"/>
            </svg>
          </button>
        </div>
      </div>
    </div>

    <div class="collection-content">
      <!-- Filtros laterales -->
      <aside id="collection-filters" class="collection-filters">
        <div class="filters-header">
          <h3>Filtros</h3>
          <button class="filters-close" aria-label="Cerrar filtros">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"/>
              <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
          </button>
        </div>

        {%- for filter in collection.filters -%}
          <div class="filter-group">
            <details open>
              <summary class="filter-title">
                {{ filter.label }}
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="6 9 12 15 18 9"/>
                </svg>
              </summary>
              <div class="filter-options">
                {%- case filter.type -%}
                  {%- when 'list' -%}
                    {%- for value in filter.values -%}
                      <label class="filter-option">
                        <input 
                          type="checkbox" 
                          name="{{ filter.param_name }}" 
                          value="{{ value.value }}"
                          {% if value.active %}checked{% endif %}
                          {% if value.count == 0 %}disabled{% endif %}
                        >
                        <span class="filter-option-label">
                          {{ value.label }}
                          <span class="filter-count">({{ value.count }})</span>
                        </span>
                      </label>
                    {%- endfor -%}
                  {%- when 'price_range' -%}
                    <div class="price-range">
                      <div class="price-inputs">
                        <div class="price-input-group">
                          <span class="price-currency">{{ cart.currency.symbol }}</span>
                          <input 
                            type="number" 
                            name="{{ filter.min_value.param_name }}" 
                            value="{{ filter.min_value.value | money_without_currency | remove: ',' }}"
                            placeholder="0"
                            min="0"
                            class="price-input"
                          >
                        </div>
                        <span class="price-separator">-</span>
                        <div class="price-input-group">
                          <span class="price-currency">{{ cart.currency.symbol }}</span>
                          <input 
                            type="number" 
                            name="{{ filter.max_value.param_name }}" 
                            value="{{ filter.max_value.value | money_without_currency | remove: ',' }}"
                            placeholder="{{ filter.range_max | money_without_currency | remove: ',' }}"
                            min="0"
                            class="price-input"
                          >
                        </div>
                      </div>
                    </div>
                {%- endcase -%}
              </div>
            </details>
          </div>
        {%- endfor -%}

        {%- if collection.filters.size > 0 -%}
          <div class="filters-actions">
            <a href="{{ collection.url }}" class="btn btn--secondary btn--sm">Limpiar filtros</a>
          </div>
        {%- endif -%}
      </aside>

      <!-- Grid de productos -->
      <div class="products-grid-wrapper">
        {%- if collection.products.size > 0 -%}
          <div class="products-grid" data-view="grid">
            {%- for product in collection.products -%}
              <article class="product-card">
                <a href="{{ product.url }}" class="product-card-link">
                  <!-- Imagen -->
                  <div class="product-card-image">
                    {%- if product.featured_media -%}
                      {{ product.featured_media | image_url: width: 600 | image_tag:
                        loading: 'lazy',
                        class: 'product-image-primary',
                        widths: '300, 400, 600',
                        sizes: '(min-width: 1024px) 25vw, (min-width: 768px) 33vw, 50vw'
                      }}
                      {%- if product.media[1] and section.settings.show_secondary_image -%}
                        {{ product.media[1] | image_url: width: 600 | image_tag:
                          loading: 'lazy',
                          class: 'product-image-secondary',
                          widths: '300, 400, 600',
                          sizes: '(min-width: 1024px) 25vw, (min-width: 768px) 33vw, 50vw'
                        }}
                      {%- endif -%}
                    {%- else -%}
                      <div class="product-card-placeholder">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                          <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                          <circle cx="8.5" cy="8.5" r="1.5"/>
                          <polyline points="21 15 16 10 5 21"/>
                        </svg>
                      </div>
                    {%- endif -%}

                    <!-- Badges -->
                    <div class="product-badges">
                      {%- if product.available == false -%}
                        <span class="badge badge--sold-out">Agotado</span>
                      {%- elsif product.compare_at_price > product.price -%}
                        <span class="badge badge--sale">
                          -{{ product.compare_at_price | minus: product.price | times: 100 | divided_by: product.compare_at_price }}%
                        </span>
                      {%- endif -%}
                      {%- if product.tags contains 'nuevo' -%}
                        <span class="badge badge--new">Nuevo</span>
                      {%- endif -%}
                    </div>

                    <!-- Quick actions -->
                    <div class="product-quick-actions">
                      <button class="quick-action-btn" aria-label="Vista rápida">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                          <circle cx="12" cy="12" r="3"/>
                        </svg>
                      </button>
                      <button class="quick-action-btn" aria-label="Agregar a favoritos">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                        </svg>
                      </button>
                    </div>
                  </div>

                  <!-- Info -->
                  <div class="product-card-info">
                    {%- if section.settings.show_vendor and product.vendor -%}
                      <p class="product-card-vendor">{{ product.vendor }}</p>
                    {%- endif -%}
                    <h3 class="product-card-title">{{ product.title }}</h3>
                    <div class="product-card-price">
                      {%- if product.compare_at_price > product.price -%}
                        <span class="price-compare">{{ product.compare_at_price | money }}</span>
                      {%- endif -%}
                      <span class="price{% if product.compare_at_price > product.price %} price--sale{% endif %}">
                        {{ product.price | money }}
                      </span>
                    </div>
                  </div>
                </a>

                <!-- Agregar al carrito rápido -->
                {%- if product.available and product.has_only_default_variant -%}
                  <form action="/cart/add" method="post" class="product-card-form">
                    <input type="hidden" name="id" value="{{ product.first_available_variant.id }}">
                    <button type="submit" class="btn btn--primary btn--sm btn--add-quick">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="9" cy="21" r="1"/>
                        <circle cx="20" cy="21" r="1"/>
                        <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
                      </svg>
                      Agregar
                    </button>
                  </form>
                {%- elsif product.available -%}
                  <a href="{{ product.url }}" class="btn btn--secondary btn--sm btn--add-quick">
                    Ver opciones
                  </a>
                {%- endif -%}
              </article>
            {%- endfor -%}
          </div>

          <!-- Paginación -->
          {%- if paginate.pages > 1 -%}
            <nav class="pagination" aria-label="Paginación">
              {%- if paginate.previous -%}
                <a href="{{ paginate.previous.url }}" class="pagination-btn pagination-prev" aria-label="Página anterior">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="15 18 9 12 15 6"/>
                  </svg>
                </a>
              {%- endif -%}

              <div class="pagination-numbers">
                {%- for part in paginate.parts -%}
                  {%- if part.is_link -%}
                    <a href="{{ part.url }}" class="pagination-number">{{ part.title }}</a>
                  {%- else -%}
                    {%- if part.title == paginate.current_page -%}
                      <span class="pagination-number pagination-current" aria-current="page">{{ part.title }}</span>
                    {%- else -%}
                      <span class="pagination-ellipsis">{{ part.title }}</span>
                    {%- endif -%}
                  {%- endif -%}
                {%- endfor -%}
              </div>

              {%- if paginate.next -%}
                <a href="{{ paginate.next.url }}" class="pagination-btn pagination-next" aria-label="Página siguiente">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="9 18 15 12 9 6"/>
                  </svg>
                </a>
              {%- endif -%}
            </nav>
          {%- endif -%}

        {%- else -%}
          <div class="collection-empty">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
              <circle cx="11" cy="11" r="8"/>
              <line x1="21" y1="21" x2="16.65" y2="16.65"/>
            </svg>
            <h2>No se encontraron productos</h2>
            <p>Intenta ajustar los filtros o busca otra cosa.</p>
            <a href="{{ routes.all_products_collection_url }}" class="btn btn--primary">Ver todos los productos</a>
          </div>
        {%- endif -%}
      </div>
    </div>
  </div>
</section>

<style>
  .collection-section {
    padding: var(--space-8) 0 var(--space-16);
    background: var(--color-bg);
  }

  .collection-container {
    max-width: var(--container-max);
    margin: 0 auto;
    padding: 0 var(--container-padding);
  }

  /* Banner de colección - Estilo NANO */
  .collection-banner {
    position: relative;
    height: 280px;
    border-radius: var(--radius-2xl);
    overflow: hidden;
    margin-bottom: var(--space-10);
    background: linear-gradient(135deg, #0C1222 0%, #1E293B 100%);
  }

  .collection-banner-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    opacity: 0.6;
  }

  .collection-banner-overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, rgba(20, 184, 166, 0.3) 0%, rgba(56, 189, 248, 0.2) 100%);
  }

  .collection-banner-content {
    position: absolute;
    inset: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: var(--space-8);
    color: white;
  }

  .collection-header-simple {
    text-align: center;
    margin-bottom: var(--space-10);
    padding: var(--space-10) var(--space-6);
    background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-secondary) 100%);
    border-radius: var(--radius-2xl);
    color: white;
  }

  .collection-title {
    font-family: var(--font-heading);
    font-size: clamp(var(--text-2xl), 5vw, var(--text-4xl));
    font-weight: 700;
    margin: 0 0 var(--space-3);
  }

  .collection-description {
    font-size: var(--text-lg);
    opacity: 0.9;
    max-width: 600px;
    margin: 0 auto;
  }

  /* Toolbar - Estilo NANO */
  .collection-toolbar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--space-4);
    padding: var(--space-4);
    background: var(--color-surface);
    border-radius: var(--radius-xl);
    border: 1px solid var(--color-border);
    margin-bottom: var(--space-8);
  }

  .toolbar-left,
  .toolbar-right {
    display: flex;
    align-items: center;
    gap: var(--space-4);
  }

  .filter-toggle {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    padding: var(--space-3) var(--space-4);
    background: var(--color-accent);
    color: white;
    border-radius: var(--radius-lg);
    font-size: var(--text-sm);
    font-weight: 600;
    transition: all var(--transition-fast);
  }

  .filter-toggle:hover {
    background: var(--color-accent-hover);
    transform: translateY(-2px);
  }

  .products-count {
    font-size: var(--text-sm);
    color: var(--color-text-secondary);
    font-weight: 500;
    padding: var(--space-2) var(--space-4);
    background: var(--color-accent-light);
    border-radius: var(--radius-full);
    color: var(--color-accent);
  }

  .sort-wrapper {
    position: relative;
  }

  .sort-select {
    appearance: none;
    padding: var(--space-3) var(--space-10) var(--space-3) var(--space-4);
    background: var(--color-bg-alt);
    border: 2px solid var(--color-border);
    border-radius: var(--radius-lg);
    font-size: var(--text-sm);
    font-weight: 500;
    cursor: pointer;
    color: var(--color-text);
    transition: all var(--transition-fast);
  }
  
  .sort-select:focus {
    outline: none;
    border-color: var(--color-accent);
  }

  .sort-icon {
    position: absolute;
    right: var(--space-3);
    top: 50%;
    transform: translateY(-50%);
    pointer-events: none;
    color: var(--color-text-secondary);
  }

  .view-toggle {
    display: flex;
    gap: var(--space-2);
  }

  .view-btn {
    width: 44px;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--color-bg-alt);
    border-radius: var(--radius-lg);
    color: var(--color-text-secondary);
    border: 2px solid transparent;
    transition: all var(--transition-fast);
  }

  .view-btn.active,
  .view-btn:hover {
    background: var(--color-accent);
    color: white;
    border-color: var(--color-accent);
  }

  /* Layout de contenido */
  .collection-content {
    display: grid;
    grid-template-columns: 280px 1fr;
    gap: var(--space-10);
  }

  /* Filtros */
  .collection-filters {
    position: sticky;
    top: 100px;
    align-self: start;
    background: var(--color-surface);
    border-radius: var(--radius-xl);
    padding: var(--space-5);
    border: 1px solid var(--color-border);
  }

  .filters-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: var(--space-5);
    padding-bottom: var(--space-4);
    border-bottom: 1px solid var(--color-border);
  }

  .filters-header h3 {
    font-family: var(--font-heading);
    font-size: var(--text-lg);
    font-weight: 700;
    color: var(--color-text);
    margin: 0;
  }

  .filters-close {
    display: none;
    width: 36px;
    height: 36px;
    align-items: center;
    justify-content: center;
    background: var(--color-bg-alt);
    border-radius: var(--radius-full);
    color: var(--color-text);
  }

  .filter-group {
    margin-bottom: var(--space-4);
    padding-bottom: var(--space-4);
    border-bottom: 1px solid var(--color-border);
  }

  .filter-group:last-of-type {
    border-bottom: none;
    margin-bottom: 0;
    padding-bottom: 0;
  }

  .filter-title {
    display: flex;
    align-items: center;
    justify-content: space-between;
    font-size: var(--text-sm);
    font-weight: 600;
    color: var(--color-text);
    cursor: pointer;
    list-style: none;
    padding: var(--space-2) 0;
  }

  .filter-title::-webkit-details-marker {
    display: none;
  }

  .filter-title svg {
    transition: transform var(--transition-fast);
    color: var(--color-text-muted);
  }

  details[open] .filter-title svg {
    transform: rotate(180deg);
  }

  .filter-options {
    padding-top: var(--space-2);
  }

  .filter-option {
    display: flex;
    align-items: center;
    gap: var(--space-3);
    padding: var(--space-2) 0;
    cursor: pointer;
  }

  .filter-option input[type="checkbox"] {
    width: 18px;
    height: 18px;
    accent-color: var(--color-accent);
    border-radius: var(--radius-sm);
  }

  .filter-option-label {
    font-size: var(--text-sm);
    color: var(--color-text-secondary);
    display: flex;
    align-items: center;
    gap: var(--space-2);
  }

  .filter-count {
    color: var(--color-text-muted);
    font-size: var(--text-xs);
  }

  .price-range {
    padding-top: var(--space-2);
  }

  .price-inputs {
    display: flex;
    align-items: center;
    gap: var(--space-3);
  }

  .price-input-group {
    display: flex;
    align-items: center;
    background: var(--color-bg-alt);
    border: 2px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: 0 var(--space-3);
    transition: all var(--transition-fast);
  }

  .price-input-group:focus-within {
    border-color: var(--color-accent);
  }

  .price-currency {
    font-size: var(--text-sm);
    color: var(--color-text-secondary);
  }

  .price-input {
    width: 80px;
    padding: var(--space-3);
    background: transparent;
    border: none;
    font-size: var(--text-sm);
    color: var(--color-text);
  }

  .price-separator {
    color: var(--color-text-muted);
  }

  .filters-actions {
    margin-top: var(--space-5);
  }

  /* Grid de productos */
  .products-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--space-6);
  }

  .products-grid[data-view="list"] {
    grid-template-columns: 1fr;
  }

  .products-grid[data-view="list"] .product-card {
    display: grid;
    grid-template-columns: 200px 1fr auto;
    align-items: center;
    gap: var(--space-6);
  }

  /* Product Card */
  .collection-section .product-card {
    background: var(--color-surface);
    border-radius: var(--radius-xl);
    overflow: hidden;
    transition: all var(--transition-base);
    border: 1px solid var(--color-border);
  }

  .collection-section .product-card:hover {
    transform: translateY(-6px);
    box-shadow: var(--shadow-lg), 0 0 30px var(--color-accent-glow);
    border-color: var(--color-border-accent);
  }

  .product-card-link {
    display: block;
  }

  .product-card-image {
    position: relative;
    aspect-ratio: 1;
    overflow: hidden;
    background: var(--color-bg-alt);
  }

  .product-image-primary,
  .product-image-secondary {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: all var(--transition-slow);
  }

  .product-image-secondary {
    position: absolute;
    inset: 0;
    opacity: 0;
  }

  .collection-section .product-card:hover .product-image-primary {
    transform: scale(1.05);
  }

  .collection-section .product-card:hover .product-image-secondary {
    opacity: 1;
  }

  .product-card-placeholder {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--color-text-muted);
  }

  .product-badges {
    position: absolute;
    top: var(--space-3);
    left: var(--space-3);
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
    z-index: 2;
  }

  .collection-section .badge {
    padding: var(--space-1) var(--space-3);
    font-size: var(--text-xs);
    font-weight: 700;
    border-radius: var(--radius-full);
  }

  .collection-section .badge--sale {
    background: var(--color-error);
    color: white;
  }

  .collection-section .badge--new {
    background: var(--color-accent);
    color: white;
  }

  .collection-section .badge--sold-out {
    background: var(--color-text-muted);
    color: white;
  }

  .product-quick-actions {
    position: absolute;
    top: var(--space-3);
    right: var(--space-3);
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
    opacity: 0;
    transform: translateX(10px);
    transition: all var(--transition-fast);
  }

  .collection-section .product-card:hover .product-quick-actions {
    opacity: 1;
    transform: translateX(0);
  }

  .quick-action-btn {
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--color-surface);
    border-radius: var(--radius-full);
    box-shadow: var(--shadow-md);
    color: var(--color-text);
    transition: all var(--transition-fast);
  }

  .quick-action-btn:hover {
    background: var(--color-accent);
    color: white;
    transform: scale(1.1);
  }

  .product-card-info {
    padding: var(--space-4);
  }

  .product-card-vendor {
    font-size: var(--text-xs);
    font-weight: 600;
    color: var(--color-accent);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin: 0 0 var(--space-1);
  }

  .product-card-title {
    font-family: var(--font-body);
    font-size: var(--text-base);
    font-weight: 600;
    color: var(--color-text);
    margin: 0 0 var(--space-2);
    line-height: 1.4;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .product-card-price {
    display: flex;
    align-items: center;
    gap: var(--space-2);
  }

  .collection-section .price {
    font-family: var(--font-heading);
    font-size: var(--text-xl);
    font-weight: 700;
    color: var(--color-accent);
  }

  .collection-section .price--sale {
    color: var(--color-error);
  }

  .collection-section .price-compare {
    font-size: var(--text-sm);
    color: var(--color-text-muted);
    text-decoration: line-through;
  }

  .product-card-form {
    padding: 0 var(--space-4) var(--space-4);
  }

  .btn--add-quick {
    width: 100%;
    background: var(--color-accent);
    color: white;
    padding: var(--space-3) var(--space-4);
    border-radius: var(--radius-lg);
    font-weight: 600;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-2);
    transition: all var(--transition-fast);
  }

  .btn--add-quick:hover {
    background: var(--color-accent-hover);
    transform: translateY(-2px);
  }

  /* Paginación */
  .pagination {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-2);
    margin-top: var(--space-10);
  }

  .pagination-btn,
  .pagination-number {
    width: 44px;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--color-surface);
    border: 2px solid var(--color-border);
    border-radius: var(--radius-lg);
    font-size: var(--text-sm);
    font-weight: 600;
    color: var(--color-text);
    transition: all var(--transition-fast);
  }

  .pagination-btn:hover,
  .pagination-number:hover {
    background: var(--color-accent);
    border-color: var(--color-accent);
    color: white;
  }

  .pagination-current {
    background: var(--color-accent);
    border-color: var(--color-accent);
    color: white;
  }

  .pagination-numbers {
    display: flex;
    gap: var(--space-2);
  }

  .pagination-ellipsis {
    width: 44px;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--color-text-muted);
  }

  /* Empty state */
  .collection-empty {
    text-align: center;
    padding: var(--space-16) var(--space-6);
    background: var(--color-surface);
    border-radius: var(--radius-2xl);
    border: 1px solid var(--color-border);
  }

  .collection-empty svg {
    color: var(--color-text-muted);
    margin-bottom: var(--space-5);
  }

  .collection-empty h2 {
    font-family: var(--font-heading);
    font-size: var(--text-2xl);
    color: var(--color-text);
    margin: 0 0 var(--space-2);
  }

  .collection-empty p {
    color: var(--color-text-secondary);
    margin-bottom: var(--space-6);
  }

  /* Responsive */
  @media (max-width: 1024px) {
    .collection-content {
      grid-template-columns: 1fr;
    }

    .collection-filters {
      position: fixed;
      top: 0;
      left: 0;
      bottom: 0;
      width: 320px;
      max-width: 90vw;
      z-index: var(--z-modal);
      border-radius: 0;
      transform: translateX(-100%);
      transition: transform var(--transition-base);
      overflow-y: auto;
    }

    .collection-filters.is-open {
      transform: translateX(0);
    }

    .filters-close {
      display: flex;
    }

    .products-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (max-width: 640px) {
    .collection-section {
      padding: var(--space-4) 0 var(--space-10);
    }

    .collection-toolbar {
      flex-wrap: wrap;
      gap: var(--space-3);
      padding: var(--space-3);
    }

    .products-grid {
      grid-template-columns: repeat(2, 1fr);
      gap: var(--space-3);
    }

    .collection-title {
      font-size: var(--text-2xl);
    }

    .collection-banner {
      height: 180px;
      margin-bottom: var(--space-6);
    }

    .collection-header-simple {
      padding: var(--space-6) var(--space-4);
      margin-bottom: var(--space-6);
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Toggle de filtros móvil
    const filterToggle = document.querySelector('.filter-toggle');
    const filters = document.querySelector('.collection-filters');
    const filtersClose = document.querySelector('.filters-close');

    if (filterToggle && filters) {
      filterToggle.addEventListener('click', () => {
        filters.classList.toggle('is-open');
        document.body.style.overflow = filters.classList.contains('is-open') ? 'hidden' : '';
      });

      filtersClose?.addEventListener('click', () => {
        filters.classList.remove('is-open');
        document.body.style.overflow = '';
      });
    }

    // Toggle de vista grid/list
    const viewBtns = document.querySelectorAll('.view-btn');
    const productsGrid = document.querySelector('.products-grid');

    viewBtns.forEach(btn => {
      btn.addEventListener('click', function() {
        viewBtns.forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        productsGrid.dataset.view = this.dataset.view;
      });
    });
  });
</script>

{%- endpaginate -%}

{% schema %}
{
  "name": "Colección principal",
  "tag": "section",
  "class": "section-collection",
  "settings": [
    {
      "type": "range",
      "id": "products_per_page",
      "min": 8,
      "max": 48,
      "step": 4,
      "default": 16,
      "label": "Productos por página"
    },
    {
      "type": "select",
      "id": "columns",
      "label": "Columnas en desktop",
      "options": [
        { "value": "3", "label": "3 columnas" },
        { "value": "4", "label": "4 columnas" }
      ],
      "default": "3"
    },
    {
      "type": "checkbox",
      "id": "show_vendor",
      "label": "Mostrar marca",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_secondary_image",
      "label": "Mostrar segunda imagen al hover",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "enable_filtering",
      "label": "Habilitar filtros",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "enable_sorting",
      "label": "Habilitar ordenamiento",
      "default": true
    }
  ]
}
{% endschema %}

